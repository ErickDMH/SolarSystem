import{g as re,r as o,_ as X,c as ne,e as oe,T as se,u as ce,a as le,b as ie,i as ue,E as ae,B as fe,d as de}from"./index-33f762b2.js";import{t as Be,f as je,h as ke,j as Ie,k as Ne,l as He,m as Ae,n as We,o as Ye,p as Ge,q as Ue,s as Xe,v as qe,w as Ve,x as $e,y as Je,z as Ke,A as Qe,C as Ze,D as et,F as tt,G as rt}from"./index-33f762b2.js";function F(t,e,n){var r,s,c,i,u;e==null&&(e=100);function l(){var d=Date.now()-i;d<e&&d>=0?r=setTimeout(l,e-d):(r=null,n||(u=t.apply(c,s),c=s=null))}var f=function(){c=this,s=arguments,i=Date.now();var d=n&&!r;return r||(r=setTimeout(l,e)),d&&(u=t.apply(c,s),c=s=null),u};return f.clear=function(){r&&(clearTimeout(r),r=null)},f.flush=function(){r&&(u=t.apply(c,s),c=s=null,clearTimeout(r),r=null)},f}F.debounce=F;var ve=F;const H=re(ve);function pe(t){let{debounce:e,scroll:n,polyfill:r,offsetSize:s}=t===void 0?{debounce:0,scroll:!1,offsetSize:!1}:t;const c=r||(typeof window>"u"?class{}:window.ResizeObserver);if(!c)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[i,u]=o.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),l=o.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:i}),f=e?typeof e=="number"?e:e.scroll:null,d=e?typeof e=="number"?e:e.resize:null,E=o.useRef(!1);o.useEffect(()=>(E.current=!0,()=>void(E.current=!1)));const[z,C,p]=o.useMemo(()=>{const a=()=>{if(!l.current.element)return;const{left:x,top:O,width:L,height:S,bottom:M,right:T,x:_,y:m}=l.current.element.getBoundingClientRect(),v={left:x,top:O,width:L,height:S,bottom:M,right:T,x:_,y:m};l.current.element instanceof HTMLElement&&s&&(v.height=l.current.element.offsetHeight,v.width=l.current.element.offsetWidth),Object.freeze(v),E.current&&!Ee(l.current.lastBounds,v)&&u(l.current.lastBounds=v)};return[a,d?H(a,d):a,f?H(a,f):a]},[u,s,f,d]);function w(){l.current.scrollContainers&&(l.current.scrollContainers.forEach(a=>a.removeEventListener("scroll",p,!0)),l.current.scrollContainers=null),l.current.resizeObserver&&(l.current.resizeObserver.disconnect(),l.current.resizeObserver=null)}function g(){l.current.element&&(l.current.resizeObserver=new c(p),l.current.resizeObserver.observe(l.current.element),n&&l.current.scrollContainers&&l.current.scrollContainers.forEach(a=>a.addEventListener("scroll",p,{capture:!0,passive:!0})))}const P=a=>{!a||a===l.current.element||(w(),l.current.element=a,l.current.scrollContainers=q(a),g())};return he(p,!!n),me(C),o.useEffect(()=>{w(),g()},[n,p,C]),o.useEffect(()=>w,[]),[P,i,z]}function me(t){o.useEffect(()=>{const e=t;return window.addEventListener("resize",e),()=>void window.removeEventListener("resize",e)},[t])}function he(t,e){o.useEffect(()=>{if(e){const n=t;return window.addEventListener("scroll",n,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",n,!0)}},[t,e])}function q(t){const e=[];if(!t||t===document.body)return e;const{overflow:n,overflowX:r,overflowY:s}=window.getComputedStyle(t);return[n,r,s].some(c=>c==="auto"||c==="scroll")&&e.push(t),[...e,...q(t.parentElement)]}const be=["x","y","top","bottom","left","right","width","height"],Ee=(t,e)=>be.every(n=>t[n]===e[n]);var we=Object.defineProperty,_e=Object.defineProperties,ye=Object.getOwnPropertyDescriptors,A=Object.getOwnPropertySymbols,Ce=Object.prototype.hasOwnProperty,ge=Object.prototype.propertyIsEnumerable,W=(t,e,n)=>e in t?we(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Y=(t,e)=>{for(var n in e||(e={}))Ce.call(e,n)&&W(t,n,e[n]);if(A)for(var n of A(e))ge.call(e,n)&&W(t,n,e[n]);return t},Oe=(t,e)=>_e(t,ye(e));function V(t,e,n){if(!t)return;if(n(t)===!0)return t;let r=e?t.return:t.child;for(;r;){const s=V(r,e,n);if(s)return s;r=e?null:r.sibling}}function $(t){try{return Object.defineProperties(t,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return t}}const B=$(o.createContext(null));class J extends o.Component{render(){return o.createElement(B.Provider,{value:this._reactInternals},this.props.children)}}const{ReactCurrentOwner:G,ReactCurrentDispatcher:U}=o.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function Re(){const t=o.useContext(B);if(t===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const e=o.useId();return o.useMemo(()=>{for(const r of[G==null?void 0:G.current,t,t==null?void 0:t.alternate]){if(!r)continue;const s=V(r,!1,c=>{let i=c.memoizedState;for(;i;){if(i.memoizedState===e)return!0;i=i.next}});if(s)return s}},[t,e])}function ze(){var t,e;const n=Re(),[r]=o.useState(()=>new Map);r.clear();let s=n;for(;s;){const c=(t=s.type)==null?void 0:t._context;c&&c!==B&&!r.has(c)&&r.set(c,(e=U==null?void 0:U.current)==null?void 0:e.readContext($(c))),s=s.return}return r}function Pe(){const t=ze();return o.useMemo(()=>Array.from(t.keys()).reduce((e,n)=>r=>o.createElement(e,null,o.createElement(n.Provider,Oe(Y({},r),{value:t.get(n)}))),e=>o.createElement(J,Y({},e))),[t])}const D={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function xe(t){const{handlePointer:e}=ne(t);return{priority:1,enabled:!0,compute(n,r,s){r.pointer.set(n.offsetX/r.size.width*2-1,-(n.offsetY/r.size.height)*2+1),r.raycaster.setFromCamera(r.pointer,r.camera)},connected:void 0,handlers:Object.keys(D).reduce((n,r)=>({...n,[r]:e(r)}),{}),update:()=>{var n;const{events:r,internal:s}=t.getState();(n=s.lastEvent)!=null&&n.current&&r.handlers&&r.handlers.onPointerMove(s.lastEvent.current)},connect:n=>{var r;const{set:s,events:c}=t.getState();c.disconnect==null||c.disconnect(),s(i=>({events:{...i.events,connected:n}})),Object.entries((r=c.handlers)!=null?r:[]).forEach(([i,u])=>{const[l,f]=D[i];n.addEventListener(l,u,{passive:f})})},disconnect:()=>{const{set:n,events:r}=t.getState();if(r.connected){var s;Object.entries((s=r.handlers)!=null?s:[]).forEach(([c,i])=>{if(r&&r.connected instanceof HTMLElement){const[u]=D[c];r.connected.removeEventListener(u,i)}}),n(c=>({events:{...c.events,connected:void 0}}))}}}}const Le=o.forwardRef(function({children:e,fallback:n,resize:r,style:s,gl:c,events:i=xe,eventSource:u,eventPrefix:l,shadows:f,linear:d,flat:E,legacy:z,orthographic:C,frameloop:p,dpr:w,performance:g,raycaster:P,camera:a,onPointerMissed:x,onCreated:O,...L},S){o.useMemo(()=>oe(se),[]);const M=Pe(),[T,_]=pe({scroll:!0,debounce:{scroll:50,resize:0},...r}),m=o.useRef(null),v=o.useRef(null);o.useImperativeHandle(S,()=>m.current);const j=ce(x),[k,K]=o.useState(!1),[I,Q]=o.useState(!1);if(k)throw k;if(I)throw I;const R=o.useRef(null);le(()=>{const y=m.current;_.width>0&&_.height>0&&y&&(R.current||(R.current=ie(y)),R.current.configure({gl:c,events:i,shadows:f,linear:d,flat:E,legacy:z,orthographic:C,frameloop:p,dpr:w,performance:g,raycaster:P,camera:a,size:_,onPointerMissed:(...h)=>j.current==null?void 0:j.current(...h),onCreated:h=>{h.events.connect==null||h.events.connect(u?ue(u)?u.current:u:v.current),l&&h.setEvents({compute:(N,b)=>{const ee=N[l+"X"],te=N[l+"Y"];b.pointer.set(ee/b.size.width*2-1,-(te/b.size.height)*2+1),b.raycaster.setFromCamera(b.pointer,b.camera)}}),O==null||O(h)}}),R.current.render(o.createElement(M,null,o.createElement(ae,{set:Q},o.createElement(o.Suspense,{fallback:o.createElement(fe,{set:K})},e)))))}),o.useEffect(()=>{const y=m.current;if(y)return()=>de(y)},[]);const Z=u?"none":"auto";return o.createElement("div",X({ref:v,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:Z,...s}},L),o.createElement("div",{ref:T,style:{width:"100%",height:"100%"}},o.createElement("canvas",{ref:m,style:{display:"block"}},n)))}),Te=o.forwardRef(function(e,n){return o.createElement(J,null,o.createElement(Le,X({},e,{ref:n})))});export{Te as Canvas,Be as ReactThreeFiber,je as _roots,ke as act,Ie as addAfterEffect,Ne as addEffect,He as addTail,Ae as advance,We as applyProps,Ye as context,ne as createEvents,Ge as createPortal,ie as createRoot,Ue as dispose,xe as events,oe as extend,Xe as flushGlobalEffects,qe as getRootState,Ve as invalidate,$e as reconciler,Je as render,de as unmountComponentAtNode,Ke as useFrame,Qe as useGraph,Ze as useInstanceHandle,et as useLoader,tt as useStore,rt as useThree};
